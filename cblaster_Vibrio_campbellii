#!/bin/bash
###############################################################################
# cblaster local database construction and T6SS cluster searches
# Author: [Your Name]
# Description:
#   1. Build local DIAMOND databases from genome assemblies
#   2. Search for T6SS-1 and T6SS-2 gene clusters using PH1401 references
###############################################################################

# =========================
# User-defined genome list
# =========================
# Example entry: "Vibrio_campbellii_1114GL"
GENOMES=(
    # Add genome base names here (without extensions)
)

# =========================
# Step 1: Build cblaster databases
# =========================
for genome in "${GENOMES[@]}"; do
    echo "============================================================"
    echo "Building cblaster database for: ${genome}"
    echo "============================================================"

    cblaster makedb \
        -n "${genome}" \
        "${genome}.gff" \
        "${genome}.fna" \
        --cpus 4 \
        -f

    echo "Database created: ${genome}.dmnd"
    echo
done

# =========================
# Step 2: Search for T6SS-1
# =========================
for genome in "${GENOMES[@]}"; do
    echo "------------------------------------------------------------"
    echo "Searching for T6SS-1 in: ${genome}"
    echo "------------------------------------------------------------"

    cblaster search \
        -m local \
        -db "${genome}.dmnd" \
        -qf t6ss1_vc.faa \
        -s "${genome}_t6ss1.json"

    echo
done

# =========================
# Step 3: Search for T6SS-2
# =========================
for genome in "${GENOMES[@]}"; do
    echo "------------------------------------------------------------"
    echo "Searching for T6SS-2 in: ${genome}"
    echo "------------------------------------------------------------"

    cblaster search \
        -m local \
        -db "${genome}.dmnd" \
        -qf t6ss2_vc.faa \
        -s "${genome}_t6ss2.json"

    echo
done

echo "All cblaster analyses completed successfully."
